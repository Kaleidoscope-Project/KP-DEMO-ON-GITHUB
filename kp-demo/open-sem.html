<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SEM ABS App</title>
    <link rel="shortcut icon" type="image/png" href="../common/images/mcln-logo.png">
    
    <!-- Step 1: Add the CheerpJ runtime loader script -->
    <script src="https://cjrtnc.leaningtech.com/4.2/loader.js"></script>

    <style>
        body {
            margin: 0; /* Remove default body margin for a true full-page background */
            padding: 0;
            display: flex;
            justify-content: center; /* Horizontally centers the app */
            align-items: center; /* Vertically centers the app */
            min-height: 100vh; /* Ensures the body takes up the full viewport height */
            background-image: url("../common/images/line-bg-1-3.png"); /*  background-color: lightblue;*/
        }

        .centered-div {
            background-color: lightgreen;
            padding: 2px;
        }

        /* Add CSS to give your container a size and style border: 1px solid black;*/
        #swing-app-container {
          width: 1400px;
          height: 800px;
          /* Optional: style the container for the CheerpJ app */
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          border: 1px solid black; /* Example styling */
        }
    </style>

    <script>
    // Example to dispatch a resize event on an element
<!--    const cheerpjContainer = document.getElementById('swing-app-container');-->
<!--    window.dispatchEvent(new Event('resize')); // May trigger a global resize event-->
<!--    if (cheerpjContainer) {-->
<!--        cheerpjContainer.dispatchEvent(new Event('resize')); // Target specific container-->
<!--    }-->
    </script>
</head>

<body>
<!-- Step 2: Define the div for your Swing app class="centered-div"-->
<div  id="swing-app-container"></div>

<!-- Step 3: Add the CheerpJ initialization script -->
<script>
    
    // Reload App function
    async function Java_sem_app_SemAppAgent_reloadSEMAPP(lib, str) {
        console.log("Received input from Java: " + str);
        await cheerpjRunJar("/app/KP-DEMO-ON-GITHUB/kp-demo/MCLN.SEM.jar");
        console.log("App r e l o a d e d.");
    }
    
    async function Java_sem_app_SemAppAgent_nativeSetApplication(lib, myApplication) {
        window.myApplication = myApplication;
        console.log(window.myApplication);
        console.log(myApplication);
        console.log("setting application");

        // Make the inputDiv visible after initialization
        //  document.getElementById('inputDiv').style.display = 'block';

        /* This makes the function 'never' return */
        return new Promise(() => { });
    }

    (async function() {
        // Get a reference to your div element
        const containerElement = document.getElementById("swing-app-container");
        
        // Initialize CheerpJ and pass the container element to create the display
        await cheerpjInit(
            {
                version: 17,
                natives: {
                    Java_sem_app_SemAppAgent_reloadSEMAPP,
                    Java_sem_app_SemAppAgent_nativeSetApplication
                }
            }
       );
      
      cheerpjCreateDisplay(1400, 800, containerElement);

      // Run your JAR file  
      // starting from index.html as
      await cheerpjRunJar("/app/KP-DEMO-ON-GITHUB/kp-demo/MCLN.SEM.jar");
    })();
    
    </script>

    <script>
        let initialDevicePixelRatio = window.devicePixelRatio;

       function handleZoomChange() {
             newDevicePixelRatio = window.devicePixelRatio;

            if (newDevicePixelRatio !== initialDevicePixelRatio) {
                console.log("Browser zoom level changed!");
                // Call your desired function here
                repaintApp();
        <!--        myCustomZoomFunction(newDevicePixelRatio);-->
<!--                initialDevicePixelRatio = newDevicePixelRatio; // Update for future comparisons-->
            } else {
                console.log("Window resized, but zoom level is the same.");
            }
        }

        function repaintApp() {
            console.log("repaintApp: repainting");
<!--            window.dispatchEvent(new Event('resize')); // May trigger a global resize event-->
            const cheerpjContainer = document.getElementById('cheerpj-app-container');
           if (cheerpjContainer) {
               cheerpjContainer.dispatchEvent(new Event('resize')); // Target specific container
           }
        }

        window.addEventListener('resize', handleZoomChange);

    </script>


</body>
</html>